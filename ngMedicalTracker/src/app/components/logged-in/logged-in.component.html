<div class="divPad container-fluid">
  <ion-app>
    <ion-content fullscreen>
      <h3 class="userWelcome text-center">
        Welcome, {{ user.fname }} {{ user.lname }}
      </h3>

      <button
        class="margin btn btn-small btn-info"
        (click)="showView = 'providers'"
      >
        My Providers
      </button>
      <button
        class="margin btn btn-small btn-info"
        (click)="showView = 'messages'"
      >
        My Messages
      </button>
      <button
        class="margin btn btn-small btn-info"
        (click)="showView = 'medications'"
      >
        My Medications
      </button>
      <button
        class="margin btn btn-small btn-info"
        (click)="showView = 'history'"
      >
        My Medical History
      </button>

      <!-- Rx -->
      <div class="display" *ngIf="showView == 'medications'">
        <table class="table">
          <thead>
            <th colspan="2">Perscriptions</th>
            <th>
              <button class="margin btn btn-small btn-info" (click)="showView = 'addMed'">
                Add medication
              </button>
            </th>
          </thead>
          <tr>
            <th>Name</th>
            <th>Description</th>
          </tr>
          <tbody>
            <tr *ngFor="let rx of medication">
              <td>
                {{ rx.name }}
              </td>
              <td>
                {{ rx.description }}
              </td>
              <td class="btn btn-info details" (click)="setRxDeets(rx)">
                View Detailed Information
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="info" *ngIf="showView == 'rxDetails'">
        <ul>
          <li>Name: {{ rxDeets.name }}</li>
          <li>Description: {{ rxDeets.description }}</li>
          <li>Dose: {{ rxDeets.dose }}</li>
          <li>Frequency: {{ rxDeets.frequency }}</li>
          <li>Provider: {{ rxDeets.provider }}</li>
          <li>Comment: {{ rxDeets.comment }}</li>
          <li>
            Current Medication:
            <input
              (change)="updateRxComponent(rxDeets)"
              type="checkbox"
              name="active"
              [(ngModel)]="rxDeets.active"
            />
          </li>
        </ul>
        <ul *ngIf="rxHisDeets">
          <button
            class="btn btn-small btn-light"
            (click)="setDxMedications(rxHisDeets)"
          >
            Diagnosis: {{ rxHisDeets.diagnosis }}
          </button>
        </ul>
        <ul *ngIf="!rxHisDeets">
          <ion-item>
            <ion-label>Link a Diagnosis?</ion-label>
            <ion-select (ionChange)="addDxToRx(rxDeets)" [(ngModel)]="dxId">
              <ion-select-option
                value="{{ dx.id }}"
                *ngFor="let dx of medicalHistory"
                >{{ dx.diagnosis }}</ion-select-option
              >
            </ion-select>
            <!-- <ion-button size="small" color="secondary" (click)="addDxToRx(rxDeets.id)">Save</ion-button> -->
          </ion-item>
        </ul>
        <input
          class="margin btn btn-success"
          type="button"
          value="Update this medication"
          (click)="setRxToUpdate(rxDeets)"
        />
        <button class="margin btn btn-danger" (click)="destroyRX()">
          Delete RX Item
        </button>
        <button class="margin btn btn-small btn-warning" (click)="reload()">
          Back
        </button>
      </div>

      <div *ngIf="showView == 'updateRx'">
        <ion-item>
          <ion-label position="stacked">Name</ion-label>
          <ion-input
            type="text"
            id="rxName"
            name="rxName"
            [(ngModel)]="rxEdit.name"
          ></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="stacked">Description</ion-label>
          <ion-input
            type="text"
            id="rxDescription"
            name="rxDescription"
            [(ngModel)]="rxEdit.description"
          ></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="stacked">Dose</ion-label>
          <ion-input
            type="text"
            id="rxDose"
            name="rxDose"
            [(ngModel)]="rxEdit.dose"
          ></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="stacked">Frequency</ion-label>
          <ion-input
            type="text"
            id="rxFrequency"
            name="rxFrequency"
            [(ngModel)]="rxEdit.frequency"
          ></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="stacked">Provider</ion-label>
          <ion-input
            type="text"
            id="rxProvider"
            name="rxProvider"
            [(ngModel)]="rxEdit.provider"
          ></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="floating">Comment</ion-label>
          <ion-input
            type="text"
            id="rxComment"
            name="rxComment"
            [(ngModel)]="rxEdit.comment"
          ></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="stacked">Active</ion-label>
          <ion-checkbox
            type="checkbox"
            name="rxActive"
            [(ngModel)]="rxEdit.active"
          ></ion-checkbox>
        </ion-item>
        <button
          type="submit"
          class="margin btn btn-lg btn-block"
          (click)="updateRxComponent(rxEdit)"
        >
          Submit
        </button>
      </div>

      <div class="formdiv" *ngIf="showView == 'addMed'">
        <ion-item>
          <ion-label position="stacked">Name</ion-label>
          <ion-input
            type="text"
            id="rxName"
            name="rxName"
            [(ngModel)]="rxEdit.name"
          ></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="stacked">Description</ion-label>
          <ion-input
            type="text"
            id="rxDescription"
            name="rxDescription"
            [(ngModel)]="rxEdit.description"
          ></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="stacked">Dose</ion-label>
          <ion-input
            type="text"
            id="rxDose"
            name="rxDose"
            [(ngModel)]="rxEdit.dose"
          ></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="stacked">Frequency</ion-label>
          <ion-input
            type="text"
            id="rxFrequency"
            name="rxFrequency"
            [(ngModel)]="rxEdit.frequency"
          ></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="stacked">Provider</ion-label>
          <ion-input
            type="text"
            id="rxProvider"
            name="rxProvider"
            [(ngModel)]="rxEdit.provider"
          ></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="stacked">Comment</ion-label>
          <ion-input
            type="text"
            id="rxComment"
            name="rxComment"
            [(ngModel)]="rxEdit.comment"
          ></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="stacked">Active</ion-label>
          <ion-checkbox
            type="checkbox"
            name="rxActive"
            [(ngModel)]="rxEdit.active"
          ></ion-checkbox>
        </ion-item>
        <button
          type="submit"
          class="margin btn btn-lg btn-block"
          (click)="createMed()"
        >
          Submit
        </button>
      </div>

      <!-- MedHis -->
      <div class="display" *ngIf="showView == 'history'">
        <table class="table">
          <thead>
            <th colspan="2">Medical History</th>
            <th>
              <button
                class="margin btn btn-small btn-info"
                (click)="showView = 'addHist'"
              >
                Add Medical History
              </button>
            </th>
          </thead>
          <tr>
            <th>Diagnosis</th>
            <th>Onset</th>
          </tr>
          <tbody>
            <tr *ngFor="let history of medicalHistory">
              <td>
                {{ history.diagnosis }}
              </td>
              <td>
                {{ history.onset }}
              </td>
              <td class="btn btn-info details" (click)="setDxMedications(history)" >
                View Detailed Information
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="info" *ngIf="showView == 'historyDetails'">
        <ul>
          <li>Diagnosis: {{ hisDeets.diagnosis }}</li>
          <li>Onset: {{ hisDeets.onset }}</li>
          <li>Treament: {{ hisDeets.treatment }}</li>
          <li>
            Active:
            <input (change)="updateHisComponent(hisDeets)" type="checkbox" name="active" [(ngModel)]="hisDeets.active"/>
          </li>
        </ul>

        <ul *ngFor="let medication of dxMedDeets">
          <button class="btn btn-small btn-light" (click)="setRxDeets(medication)">
            Meds: {{ medication.name }}
          </button>
        </ul>
        <button
          class="margin btn btn-success"
          (click)="setHistToEdit(hisDeets)"
        >
          Update This Diagnosis
        </button>
        <button class="margin btn btn-danger" (click)="destroyHist()">
          Delete This Entry
        </button>

        <button class="margin btn btn-small btn-warning" (click)="reload()">
          Back

        <button class="margin btn btn-small btn-light" (click)="showView = 'history'">
          Back To Medical History

        </button>
      </div>

      <div *ngIf="showView == 'editHistory'">
        <br />
        <h5>Edit Medical History Entry</h5>
        <ion-item>
          <ion-label position="stacked" for="histDx">Diagnosis:</ion-label>
          <ion-input
            type="text"
            id="histDx"
            name="diagnosisName"
            [(ngModel)]="histEdit.diagnosis"
          ></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="stacked" for="histOnset">Onset:</ion-label>
          <ion-input
            type="text"
            id="histOnset"
            name="Onset"
            [(ngModel)]="histEdit.onset"
          ></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="stacked" for="histTreat">Treatment:</ion-label>
          <ion-input
            type="text"
            id="histTreat"
            name="Onset"
            [(ngModel)]="histEdit.treatment"
          ></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="stacked">Active</ion-label>
          <ion-checkbox
            type="checkbox"
            name="histActive"
            [(ngModel)]="histEdit.active"
          ></ion-checkbox>
        </ion-item>
        <button
          class="btn btn-lg btn-success btn-block"
          (click)="updateHisComponent(histEdit)"
        >
          Submit
        </button>
      </div>

      <div class="formdiv" *ngIf="showView == 'addHist'">
        <h3>Add Medical History Item:</h3>
        <ion-item>
          <ion-label position="stacked" for="histDx">Diagnosis:</ion-label>
          <ion-input
            type="text"
            id="histDx"
            name="diagnosisName"
            [(ngModel)]="histEdit.diagnosis"
          ></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="stacked" for="histOnset">Onset:</ion-label>
          <ion-input
            type="text"
            id="histOnset"
            name="Onset"
            [(ngModel)]="histEdit.onset"
          ></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="stacked" for="histTreat">Treatment:</ion-label>
          <ion-input
            type="text"
            id="histTreat"
            name="Onset"
            [(ngModel)]="histEdit.treatment"
          ></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="stacked">Active</ion-label>
          <ion-checkbox
            type="checkbox"
            name="histActive"
            [(ngModel)]="histEdit.active"
          ></ion-checkbox>
        </ion-item>
        <button
          class="btn btn-lg btn-success btn-block"
          (click)="createMedicalHistory()"
        >
          Submit
        </button>
      </div>

      <div class="display" *ngIf="showView == 'addProvider'">
        <ion-item>
          <ion-label position="stacked">Enter your provider's ID. Not sure? Contact your provider and ask them about MedTrak!</ion-label>
          <ion-input type="number" [(ngModel)]="provId"></ion-input>
        </ion-item>
        <ion-item>
          <button class="margin btn btn-success" (click)="addProvider(provId)">Submit</button>
          <button class="margin btn btn-light" (click)="showView='providers'">Back</button>
        </ion-item>
      </div>

      <div class="display" *ngIf="showView == 'providers'">
        <table class="table">
          <thead>
            <th colspan="2">My Providers</th>
            <th><button class="btn btn-info" (click)="showView = 'addProvider'">Add A Provider</button></th>
          </thead>
          <tr>
            <th>Name</th>
            <th>Title</th>
          </tr>
          <tbody>
            <tr *ngFor="let p of providers">
              <td>{{p.fname}} {{p.lname}}</td>
              <td>{{p.title}}</td>
              <td><button class="btn btn-info" (click)="setProviderDetails(p)">More Information</button></td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="display" *ngIf="showView == 'providerDetails'">
        <table class="table">
          <thead><th>Provider Details</th></thead>
          <tbody>
            <tr>
              <td>Title</td>
              <td>{{provDetails.title}}</td>
            </tr>
            <tr>
              <td>Name</td>
              <td>{{provDetails.fname}} {{provDetails.lname}}</td>
            </tr>
            <tr>
              <td>Location</td>
              <td>{{provDetails.location}}</td>
            </tr>
          </tbody>
        </table>
        <button class="margin btn btn=small btn-light" (click)="showView = 'providers'">Back</button>
        <button class="margin btn btn-small btn-info" (click)="msgProvId = provDetails.id">
          Message Provider
        </button>
        <button class="margin btn btn-danger" (click)="removeProvider(provDetails.id)">
          Remove Provider
        </button>
      </div>

      <div class="info" *ngIf="showView == 'messages'">
        <h1>My Messages:</h1>
        <ul *ngFor="let msg of messages">
          <li>
            {{ msg.content }} <br />
            <button class="margin btn btn-danger" (click)="deleteMessage(msg)">
              Delete Message
            </button>
            <button class="margin btn btn-info" (click)="msgEdit = msg">
              Update This Message
            </button>
          </li>
        </ul>

        <div *ngIf="msgEdit">
          <input type="text" name="content" [(ngModel)]="msgEdit.content" />
          <button
            class="margin btn btn-success"
            (click)="updateMessage(msgEdit)"
          >
            Submit Message
          </button>
          <br />
          <!-- <button id="bottomCancel" class="margin btn btn-warning" (click)="msgToEdit = null">Cancel</button> -->
        </div>
        <button
          class="margin btn btn-small btn-warning"
          (click)="showView = 'medications'"
        >
          Close Messages
        </button>
      </div>
    </ion-content>
  </ion-app>
</div>
